<!DOCTYPE html>
<html lang="mn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–≤—Ç–æ–º–∞—Ç –¢“Ø–≤—à–∏–Ω –¢–æ–≥—Ç–æ–æ—Ö –®–∞–ª–≥–∞–ª—Ç (–•–∞—Ä–≥–∞–ª–∑—É—É–ª–∞—Ö –Ω—ç–º—ç–ª—Ç—Ç—ç–π)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            user-select: none;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800 font-sans min-h-screen" oncontextmenu="return false;">

    <div id="app" class="max-w-4xl mx-auto p-4">

        <div id="view-dashboard" class="fade-in">
            <header class="mb-8 text-center">
                <h1 class="text-3xl font-bold text-blue-700">–®–∞–ª–≥–∞–ª—Ç –ë—ç–ª—Ç–≥—ç—Ö –°–∏—Å—Ç–µ–º</h1>
                <p class="text-gray-500">v3.0 - –•–∞—Ä–≥–∞–ª–∑—É—É–ª–∞—Ö –¥–∞—Å–≥–∞–ª—Ç–∞–π</p>
            </header>

            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-xl shadow-md border-l-4 border-blue-500 cursor-pointer hover:shadow-lg transition" onclick="startPresetExam()">
                    <h2 class="text-xl font-bold text-gray-800">–°–∏—Å—Ç–µ–º–∏–π–Ω –ë—ç–ª—ç–Ω –®–∞–ª–≥–∞–ª—Ç</h2>
                    <p class="text-sm text-gray-600 mt-2">–ó–∞—Å–≤–∞—Ä–ª–∞—Ö –±–æ–ª–æ–º–∂–≥“Ø–π, –±—ç–ª—ç–Ω –∑–∞–≥–≤–∞—Ä.</p>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-md border-l-4 border-purple-500 cursor-pointer hover:shadow-lg transition" onclick="goToCustomEditor()">
                    <h2 class="text-xl font-bold text-gray-800">–ê–¥–º–∏–Ω –ó–æ—Ö–∏–æ—Ö –®–∞–ª–≥–∞–ª—Ç</h2>
                    <p class="text-sm text-gray-600 mt-2">–•–∞—Ä–≥–∞–ª–∑—É—É–ª–∞—Ö, –°–æ–Ω–≥–æ—Ö –¥–∞—Å–≥–∞–ª –±“Ø—Ö–∏–π –±“Ø—Ä—ç–Ω —Ç–æ—Ö–∏—Ä–≥–æ–æ.</p>
                </div>
            </div>
        </div>

        <div id="view-editor" class="hidden fade-in pb-20">
            <div class="sticky top-0 z-20 bg-white/95 backdrop-blur shadow-md p-4 rounded-b-xl flex justify-between items-center mb-6 border border-gray-200">
                <button onclick="showView('view-dashboard')" class="text-gray-500 hover:text-gray-700 font-semibold">‚Üê –ë—É—Ü–∞—Ö</button>
                <div class="text-lg font-bold text-green-700 bg-green-50 px-4 py-1 rounded-full border border-green-200">
                    –ù–∏–π—Ç –æ–Ω–æ–æ: <span id="admin-total-score">0</span>
                </div>
                <button onclick="startCustomExam()" class="bg-green-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-green-700 shadow hover:shadow-lg transition">
                    –ù–∏–π—Ç–ª—ç—Ö & –≠—Ö–ª“Ø“Ø–ª—ç—Ö
                </button>
            </div>

            <h2 class="text-2xl font-bold mb-4 text-gray-800 pl-1 border-l-4 border-purple-500">–ê—Å—É—É–ª—Ç –ó–æ—Ö–∏–æ—Ö</h2>

            <div id="question-editor-container" class="space-y-6"></div>

            <button onclick="addNewQuestion()" class="mt-8 w-full border-2 border-dashed border-purple-300 text-purple-600 font-bold py-4 rounded-xl hover:bg-purple-50 hover:border-purple-400 transition flex items-center justify-center gap-2">
                <span class="text-2xl">+</span> –®–∏–Ω—ç –∞—Å—É—É–ª—Ç –Ω—ç–º—ç—Ö
            </button>
        </div>

        <div id="view-exam" class="hidden fade-in select-none">
            <div class="flex justify-between items-center mb-6 bg-white p-4 rounded-xl shadow-sm">
                <div>
                    <h2 class="font-bold text-gray-700">–®–∞–ª–≥–∞–ª—Ç</h2>
                    <div class="w-48 bg-gray-200 rounded-full h-2.5 mt-2">
                        <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-xs text-gray-500">“Æ–ª–¥—Å—ç–Ω —Ö—É–≥–∞—Ü–∞–∞</p>
                    <div id="timer-display" class="text-2xl font-mono font-bold text-red-600">--:--</div>
                </div>
            </div>

            <div class="bg-white p-8 rounded-xl shadow-md min-h-[300px] flex flex-col justify-between">
                <div>
                    <span id="q-type-badge" class="bg-gray-100 text-gray-600 text-xs font-bold px-2 py-1 rounded uppercase mb-2 inline-block">Type</span>
                    <h3 id="q-text" class="text-xl font-semibold text-gray-900 mb-6">Question...</h3>

                    <div id="q-content-area" class="space-y-4"></div>
                </div>

                <div class="mt-8 flex justify-end">
                    <button onclick="nextQuestion()" class="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-blue-700 shadow-lg transform transition hover:-translate-y-1">
                        –î–∞—Ä–∞–∞–≥–∏–π–Ω—Ö ‚Üí
                    </button>
                </div>
            </div>
        </div>

        <div id="view-result" class="hidden fade-in text-center pt-10">
            <div class="bg-white p-10 rounded-2xl shadow-xl max-w-lg mx-auto">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">–®–∞–ª–≥–∞–ª—Ç –î—É—É—Å–ª–∞–∞!</h2>
                <div class="bg-blue-50 p-6 rounded-xl mb-6 mt-6">
                    <p class="text-sm text-gray-500 uppercase">–¢–∞–Ω—ã —Ç“Ø–≤—à–∏–Ω</p>
                    <h1 id="result-level" class="text-5xl font-extrabold text-blue-700 my-2">--</h1>
                    <p id="result-score" class="text-gray-700 font-semibold">-- / --</p>
                </div>
                <button onclick="location.reload()" class="bg-gray-800 text-white px-6 py-2 rounded-lg hover:bg-gray-900">–≠—Ö–ª—ç–ª —Ä“Ø“Ø –±—É—Ü–∞—Ö</button>
            </div>
        </div>

    </div>

    <script>
        // --- DATA STRUCTURE ---
        // New structure supports 'pairs' for matching questions
        const defaultQuestions = [{
            id: 1,
            type: 'radio',
            text: "–ú–æ–Ω–≥–æ–ª —É–ª—Å—ã–Ω –Ω–∏–π—Å–ª—ç–ª?",
            options: ["–≠—Ä–¥—ç–Ω—ç—Ç", "–£–ª–∞–∞–Ω–±–∞–∞—Ç–∞—Ä", "–î–∞—Ä—Ö–∞–Ω"],
            correct: 1,
            score: 2,
            pairs: []
        }, {
            id: 2,
            type: 'matching',
            text: "–£–ª—Å—É—É–¥—ã–≥ –Ω–∏–π—Å–ª—ç–ª—Ç—ç–π –Ω—å —Ö–æ–ª–±–æ–Ω–æ —É—É.",
            options: [],
            correct: null,
            score: 4,
            pairs: [{
                left: "–ú–æ–Ω–≥–æ–ª",
                right: "–£–ª–∞–∞–Ω–±–∞–∞—Ç–∞—Ä"
            }, {
                left: "–§—Ä–∞–Ω—Ü",
                right: "–ü–∞—Ä–∏—Å"
            }, {
                left: "–Ø–ø–æ–Ω",
                right: "–¢–æ–∫–∏–æ"
            }]
        }];

        let editingQuestions = [];
        let activeExamQuestions = [];

        let currentQIndex = 0;
        let userScore = 0;
        let totalExamScore = 0;
        let timerInterval;
        let timeLeft = 2400;

        function showView(id) {
            document.querySelectorAll('#app > div').forEach(div => div.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        // --- EDITOR LOGIC ---

        function goToCustomEditor() {
            if (editingQuestions.length === 0) {
                editingQuestions = JSON.parse(JSON.stringify(defaultQuestions));
            }
            renderEditor();
            showView('view-editor');
        }

        function addNewQuestion() {
            const newQ = {
                id: Date.now(),
                type: 'radio', // default
                text: '',
                options: ['–°–æ–Ω–≥–æ–ª—Ç 1', '–°–æ–Ω–≥–æ–ª—Ç 2'],
                correct: 0,
                score: 1,
                pairs: [{
                    left: "“Æ–≥ A",
                    right: "–•–∞—Ä–∏—É A"
                }, {
                    left: "“Æ–≥ B",
                    right: "–•–∞—Ä–∏—É B"
                }]
            };
            editingQuestions.push(newQ);
            renderEditor();
            setTimeout(() => window.scrollTo(0, document.body.scrollHeight), 100);
        }

        function deleteQuestion(index) {
            if (confirm("–£—Å—Ç–≥–∞—Ö —É—É?")) {
                editingQuestions.splice(index, 1);
                renderEditor();
            }
        }

        function renderEditor() {
            const container = document.getElementById('question-editor-container');
            container.innerHTML = '';
            let totalScore = 0;

            editingQuestions.forEach((q, qIndex) => {
                totalScore += parseInt(q.score) || 0;

                // Render Content based on Type
                let contentHTML = '';

                if (q.type === 'matching') {
                    // --- MATCHING EDITOR UI ---
                    let pairsHTML = '';
                    q.pairs.forEach((pair, pIndex) => {
                        pairsHTML += `
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-gray-400 font-bold">${pIndex + 1}.</span>
                                <input type="text" value="${pair.left}" oninput="updatePair(this.value, ${qIndex}, ${pIndex}, 'left')" class="flex-1 border p-2 rounded bg-gray-50" placeholder="–ó“Ø“Ø–Ω —Ç–∞–ª (–ê—Å—É—É–ª—Ç)">
                                <span class="text-gray-400">‚Üî</span>
                                <input type="text" value="${pair.right}" oninput="updatePair(this.value, ${qIndex}, ${pIndex}, 'right')" class="flex-1 border p-2 rounded bg-blue-50" placeholder="–ë–∞—Ä—É—É–Ω —Ç–∞–ª (–ó”©–≤ —Ö–∞—Ä–∏—É)">
                                <button onclick="removePair(${qIndex}, ${pIndex})" class="text-red-400 hover:text-red-600 font-bold px-2">√ó</button>
                            </div>
                        `;
                    });
                    contentHTML = `
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <label class="text-xs font-bold text-gray-400 uppercase block mb-2">–•–∞—Ä–≥–∞–ª–∑—É—É–ª–∞—Ö —Ö–æ—Å—É—É–¥ (–ó“Ø“Ø–Ω - –ë–∞—Ä—É—É–Ω)</label>
                            ${pairsHTML}
                            <button onclick="addPair(${qIndex})" class="mt-2 text-sm text-blue-600 font-semibold hover:underline">+ –•–æ—Å –Ω—ç–º—ç—Ö</button>
                        </div>
                    `;
                } else {
                    // --- CHOICE EDITOR UI ---
                    let optionsHTML = '';
                    q.options.forEach((opt, optIndex) => {
                        const isChecked = (q.type === 'radio' && q.correct === optIndex) || (q.type === 'checkbox' && Array.isArray(q.correct) && q.correct.includes(optIndex));
                        const markerColor = isChecked ? 'bg-green-500 border-green-500' : 'bg-white border-gray-300';
                        optionsHTML += `
                            <div class="flex items-center gap-2 mb-2">
                                <div onclick="setCorrectOption(${qIndex}, ${optIndex})" class="w-6 h-6 rounded-full border-2 cursor-pointer flex items-center justify-center ${markerColor} text-white text-xs">‚úî</div>
                                <input type="text" value="${opt}" oninput="updateOptionText(${qIndex}, ${optIndex}, this.value)" class="flex-1 border p-2 rounded text-sm" placeholder="–•–∞—Ä–∏—É–ª—Ç...">
                                <button onclick="removeOption(${qIndex}, ${optIndex})" class="text-red-400 hover:text-red-600 font-bold px-2">√ó</button>
                            </div>
                        `;
                    });
                    contentHTML = `
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <label class="text-xs font-bold text-gray-400 uppercase block mb-2">–•–∞—Ä–∏—É–ª—Ç—É—É–¥ (–ó”©–≤ —Ö–∞—Ä–∏—É–≥ —Ç—ç–º–¥—ç–≥–ª—ç–Ω—ç “Ø“Ø)</label>
                            ${optionsHTML}
                            <button onclick="addOption(${qIndex})" class="mt-2 text-sm text-blue-600 font-semibold hover:underline">+ –•–∞—Ä–∏—É–ª—Ç –Ω—ç–º—ç—Ö</button>
                        </div>
                    `;
                }

                const html = `
                    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 relative group">
                        <button onclick="deleteQuestion(${qIndex})" class="absolute top-4 right-4 text-red-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition">–£—Å—Ç–≥–∞—Ö üóëÔ∏è</button>
                        <div class="flex gap-4 mb-4">
                            <div class="w-1/3">
                                <label class="text-xs font-bold text-gray-500 uppercase block mb-1">–¢”©—Ä”©–ª</label>
                                <select onchange="updateQuestionType(${qIndex}, this.value)" class="w-full border p-2 rounded bg-gray-50">
                                    <option value="radio" ${q.type === 'radio' ? 'selected' : ''}>–ù—ç–≥ —Å–æ–Ω–≥–æ–ª—Ç (Radio)</option>
                                    <option value="checkbox" ${q.type === 'checkbox' ? 'selected' : ''}>–û–ª–æ–Ω —Å–æ–Ω–≥–æ–ª—Ç (Checkbox)</option>
                                    <option value="matching" ${q.type === 'matching' ? 'selected' : ''}>–•–∞—Ä–≥–∞–ª–∑—É—É–ª–∞—Ö (Matching)</option>
                                </select>
                            </div>
                            <div class="w-1/4">
                                <label class="text-xs font-bold text-gray-500 uppercase block mb-1">–û–Ω–æ–æ</label>
                                <input type="number" min="1" value="${q.score}" oninput="updateScore(${qIndex}, this.value)" class="w-full border p-2 rounded text-center font-bold text-blue-600">
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="text-xs font-bold text-gray-500 uppercase block mb-1">–ê—Å—É—É–ª—Ç</label>
                            <input type="text" value="${q.text}" oninput="updateQuestionText(${qIndex}, this.value)" class="w-full border p-2 rounded font-medium text-lg focus:ring-2 ring-blue-100 outline-none" placeholder="–ê—Å—É—É–ª—Ç–∞–∞ —ç–Ω–¥ –±–∏—á–Ω—ç “Ø“Ø...">
                        </div>
                        ${contentHTML}
                    </div>
                `;
                container.innerHTML += html;
            });

            document.getElementById('admin-total-score').innerText = totalScore;
        }

        // --- UPDATE FUNCTIONS ---
        function updateQuestionText(qIndex, val) {
            editingQuestions[qIndex].text = val;
        }

        function updateScore(qIndex, val) {
            editingQuestions[qIndex].score = parseInt(val) || 0;
            renderEditor(); // Refresh total
        }

        function updateQuestionType(qIndex, val) {
            editingQuestions[qIndex].type = val;
            renderEditor();
        }

        // Choice Helpers
        function updateOptionText(qIndex, optIndex, val) {
            editingQuestions[qIndex].options[optIndex] = val;
        }

        function addOption(qIndex) {
            editingQuestions[qIndex].options.push("");
            renderEditor();
        }

        function removeOption(qIndex, optIndex) {
            editingQuestions[qIndex].options.splice(optIndex, 1);
            renderEditor();
        }

        function setCorrectOption(qIndex, optIndex) {
            const q = editingQuestions[qIndex];
            if (q.type === 'radio') q.correct = optIndex;
            else {
                if (!Array.isArray(q.correct)) q.correct = [];
                const idx = q.correct.indexOf(optIndex);
                if (idx > -1) q.correct.splice(idx, 1);
                else q.correct.push(optIndex);
            }
            renderEditor();
        }

        // Matching Helpers
        function updatePair(val, qIndex, pIndex, side) {
            editingQuestions[qIndex].pairs[pIndex][side] = val;
        }

        function addPair(qIndex) {
            editingQuestions[qIndex].pairs.push({
                left: "",
                right: ""
            });
            renderEditor();
        }

        function removePair(qIndex, pIndex) {
            editingQuestions[qIndex].pairs.splice(pIndex, 1);
            renderEditor();
        }

        // --- EXAM LOGIC ---

        function startPresetExam() {
            activeExamQuestions = JSON.parse(JSON.stringify(defaultQuestions));
            initExam();
        }

        function startCustomExam() {
            if (editingQuestions.length === 0) {
                alert("–ê—Å—É—É–ª—Ç –±–∞–π—Ö–≥“Ø–π –±–∞–π–Ω–∞!");
                return;
            }
            activeExamQuestions = JSON.parse(JSON.stringify(editingQuestions));
            initExam();
        }

        function initExam() {
            totalExamScore = activeExamQuestions.reduce((acc, q) => acc + q.score, 0);
            userScore = 0;
            currentQIndex = 0;
            timeLeft = 2400;
            showView('view-exam');
            renderExamQuestion();
            startTimer();
        }

        function renderExamQuestion() {
            const q = activeExamQuestions[currentQIndex];
            const progress = ((currentQIndex) / activeExamQuestions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;

            let badge = q.type === 'radio' ? '–ù—ç–≥ —Å–æ–Ω–≥–æ–ª—Ç' : (q.type === 'matching' ? '–•–∞—Ä–≥–∞–ª–∑—É—É–ª–∞—Ö' : '–û–ª–æ–Ω —Å–æ–Ω–≥–æ–ª—Ç');
            document.getElementById('q-type-badge').innerText = badge;
            document.getElementById('q-text').innerText = `${currentQIndex + 1}. ${q.text}`;

            const container = document.getElementById('q-content-area');
            container.innerHTML = '';

            if (q.type === 'matching') {
                // --- RENDER MATCHING ---
                // 1. –ó”©–≤ —Ö–∞—Ä–∏—É–ª—Ç—É—É–¥—ã–≥ —Ü—É–≥–ª—É—É–ª–∂ —Ö–æ–ª–∏–Ω–æ (Shuffle right side)
                const rightOptions = q.pairs.map((p, idx) => ({
                    text: p.right,
                    originalIndex: idx
                }));
                // Fisher-Yates Shuffle
                for (let i = rightOptions.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [rightOptions[i], rightOptions[j]] = [rightOptions[j], rightOptions[i]];
                }

                // 2. –ó“Ø“Ø–Ω —Ç–∞–ª—ã–≥ –∂–∞–≥—Å–∞–∞–∂, —Ö–∞–∂—É—É–¥ –Ω—å Dropdown “Ø“Ø—Å–≥—ç–Ω—ç
                q.pairs.forEach((pair, idx) => {
                    let dropdown = `<select name="match_ans_${idx}" class="border border-gray-300 p-2 rounded bg-white w-full">
                                        <option value="-1">-- –°–æ–Ω–≥–æ—Ö --</option>`;
                    rightOptions.forEach(opt => {
                        dropdown += `<option value="${opt.originalIndex}">${opt.text}</option>`;
                    });
                    dropdown += `</select>`;

                    container.innerHTML += `
                        <div class="grid grid-cols-2 gap-4 items-center border-b border-gray-100 pb-2 mb-2">
                            <div class="font-medium text-gray-700">${pair.left}</div>
                            <div>${dropdown}</div>
                        </div>
                    `;
                });

            } else {
                // --- RENDER CHOICE ---
                const inputType = q.type === 'radio' ? 'radio' : 'checkbox';
                q.options.forEach((opt, idx) => {
                    container.innerHTML += `
                        <label class="flex items-center bg-gray-50 p-4 rounded-lg cursor-pointer hover:bg-blue-50 border border-transparent hover:border-blue-200 transition">
                            <input type="${inputType}" name="ans" value="${idx}" class="w-5 h-5 text-blue-600">
                            <span class="ml-3 text-gray-700 font-medium">${opt}</span>
                        </label>
                    `;
                });
            }
        }

        function nextQuestion() {
            const q = activeExamQuestions[currentQIndex];

            if (q.type === 'matching') {
                // --- SCORING MATCHING ---
                // –ó”©–≤ —Ö–æ—Å –±“Ø—Ä—Ç —Ö—É–≤—å—á–∏–ª–∂ –æ–Ω–æ–æ ”©–≥–Ω”©. –ñ–∏—à—ç—ç: –ù–∏–π—Ç 5 –æ–Ω–æ–æ, 5 —Ö–æ—Å –±–∞–π–≤–∞–ª 1 —Ö–æ—Å = 1 –æ–Ω–æ–æ.
                const pairValue = q.score / q.pairs.length;
                let correctMatches = 0;

                q.pairs.forEach((_, idx) => {
                    const select = document.querySelector(`select[name="match_ans_${idx}"]`);
                    // Check if user selected the index that matches the current pair index
                    if (select && parseInt(select.value) === idx) {
                        correctMatches++;
                    }
                });
                userScore += (correctMatches * pairValue);

            } else {
                // --- SCORING CHOICE ---
                const inputs = document.querySelectorAll('input[name="ans"]:checked');
                if (q.type === 'radio') {
                    if (inputs.length > 0 && parseInt(inputs[0].value) === q.correct) {
                        userScore += q.score;
                    }
                } else {
                    const selected = Array.from(inputs).map(i => parseInt(i.value)).sort();
                    const correctArr = Array.isArray(q.correct) ? q.correct.sort() : [q.correct];
                    if (JSON.stringify(selected) === JSON.stringify(correctArr)) {
                        userScore += q.score;
                    }
                }
            }

            currentQIndex++;
            if (currentQIndex < activeExamQuestions.length) {
                renderExamQuestion();
            } else {
                finishExam();
            }
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                let m = Math.floor(timeLeft / 60);
                let s = timeLeft % 60;
                document.getElementById('timer-display').innerText = `${m}:${s < 10 ? '0'+s : s}`;
                if (timeLeft <= 0) finishExam();
            }, 1000);
        }

        function finishExam() {
            clearInterval(timerInterval);
            showView('view-result');

            const percent = (userScore / totalExamScore) * 100 || 0;
            let level = 'A1';
            if (percent >= 90) level = 'C1 (Advanced)';
            else if (percent >= 70) level = 'B2 (Upper Intermediate)';
            else if (percent >= 50) level = 'B1 (Intermediate)';
            else if (percent >= 30) level = 'A2 (Elementary)';

            document.getElementById('result-level').innerText = level;
            document.getElementById('result-score').innerText = `${userScore.toFixed(1)} / ${totalExamScore} (${Math.round(percent)}%)`;
        }
    </script>
</body>

</html>